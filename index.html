<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Illusion Gallery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Base styles for all text elements in SVGs */
        .svg-text-base {
            /* Styles are now applied inline, but we keep the class for JS selection */
            font-size: 120px;
            font-weight: 900;
            font-family: 'Arial Black', 'Impact', sans-serif;
            text-anchor: middle;
            dominant-baseline: middle;
        }
        
        /* Styles for the new Canvas effect (from your code) */
        #tilt-canvas, #ascii-canvas {
            width: 100%;
            min-width: 200px;
            max-width: 500px;
            border: 1px solid #e5e7eb; /* border-gray-200 */
            border-radius: 0.5rem; /* rounded-lg */
            margin: 0 auto; /* Center it */
            display: block;
        }
        
        .tilt-input, .ascii-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #D1D5DB; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
        }
        
        .image-preview {
            max-width: 100px;
            max-height: 100px;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4 md:p-8">

    <div class="w-full max-w-7xl bg-white rounded-lg shadow-xl p-6 md:p-8">
        
        <h1 class="text-3xl md:text-4xl font-bold text-center text-gray-900 mb-4">
            Printable Text Illusion Gallery
        </h1>
        <p class="text-center text-gray-600 mb-8">
            Type in the box below to see your text rendered in 14 different illusion styles.
        </p>

        <div class="mb-10 max-w-2xl mx-auto sticky top-4 z-10 bg-white/95 backdrop-blur-sm p-4 rounded-lg shadow-lg">
            <label for="text-input" class="block text-sm font-medium text-gray-700 mb-2">
                Enter your word:
            </label>
            <input type="text" 
                   id="text-input" 
                   value="SECURITY" 
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 text-2xl" 
                   oninput="updateAllText()">
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">

            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">1. Line Illusion</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-1" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <pattern id="pattern-1" width="10" height="10" patternTransform="rotate(-45)" patternUnits="userSpaceOnUse">
                                <rect width="10" height="10" fill="white"/><line x1="0" y1="5" x2="10" y2="5" stroke="black" stroke-width="5"/>
                            </pattern>
                            <pattern id="pattern-2" width="10" height="10" patternTransform="rotate(45)" patternUnits="userSpaceOnUse">
                                <rect width="10" height="10" fill="white"/><line x1="0" y1="5" x2="10" y2="5" stroke="black" stroke-width="5"/>
                            </pattern>
                            <mask id="text-mask-1">
                                <rect width="800" height="400" fill="black" />
                                <text id="svg-text-1" class="svg-text-base" x="400" y="200" fill="white" 
                                      text-anchor="middle" dominant-baseline="middle" 
                                      font-size="120px" font-weight="900" font-family="'Arial Black', 'Impact', sans-serif">SECURITY</text>
                            </mask>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <rect width="800" height="400" fill="url(#pattern-1)" />
                        <rect width="800" height="400" fill="url(#pattern-2)" mask="url(#text-mask-1)" />
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-1', 'line-illusion')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">2. Guilloché Security Pattern</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-2" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <pattern id="pattern-guilloche-1" width="20" height="20" patternUnits="userSpaceOnUse">
                                <path d="M -5 10 Q 5 0, 15 10 T 25 10" stroke="#aaa" stroke-width="1.5" fill="none"/>
                                <path d="M -5 20 Q 5 10, 15 20 T 25 20" stroke="#aaa" stroke-width="1.5" fill="none"/>
                            </pattern>
                            <pattern id="pattern-guilloche-2" width="20" height="20" patternUnits="userSpaceOnUse">
                                <path d="M 10 -5 Q 20 5, 10 15 T 10 25" stroke="black" stroke-width="1" fill="none"/>
                                <path d="M 20 -5 Q 10 5, 20 15 T 20 25" stroke="black" stroke-width="1" fill="none"/>
                            </pattern>
                            <mask id="text-mask-2">
                                <rect width="800" height="400" fill="black" />
                                <text id="svg-text-2" class="svg-text-base" x="400" y="200" fill="white" 
                                      text-anchor="middle" dominant-baseline="middle" 
                                      font-size="120px" font-weight="900" font-family="'Arial Black', 'Impact', sans-serif">SECURITY</text>
                            </mask>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <rect width="800" height="400" fill="url(#pattern-guilloche-1)" />
                        <rect width="800" height="400" fill="url(#pattern-guilloche-2)" mask="url(#text-mask-2)" />
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-2', 'guilloche-security')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">3. Void (Negative Space)</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-3" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <pattern id="pattern-3" width="10" height="10" patternTransform="rotate(45)" patternUnits="userSpaceOnUse">
                                <rect width="10" height="10" fill="white"/><line x1="0" y1="5" x2="10" y2="5" stroke="black" stroke-width="5"/>
                            </pattern>
                            <mask id="text-mask-3">
                                <rect width="800" height="400" fill="white" />
                                <text id="svg-text-3" class="svg-text-base" x="400" y="200" fill="black" 
                                      text-anchor="middle" dominant-baseline="middle" 
                                      font-size="120px" font-weight="900" font-family="'Arial Black', 'Impact', sans-serif">SECURITY</text>
                            </mask>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <rect width="800" height="400" fill="url(#pattern-3)" mask="url(#text-mask-3)" />
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-3', 'void-negative')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">4. Embossed (Watermark)</h2>
                <div class="w-full bg-gray-200 border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-4" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <filter id="filter-emboss">
                                <feDropShadow dx="1.5" dy="1.5" stdDeviation="0.5" flood-color="#000" flood-opacity="0.3"/>
                                <feDropShadow dx="-1.5" dy="-1.5" stdDeviation="0.5" flood-color="#FFF" flood-opacity="0.5"/>
                            </filter>
                        </defs>
                        <rect width="800" height="400" fill="#E5E7EB" />
                        <text id="svg-text-4" class="svg-text-base" x="400" y="200" fill="#E5E7EB" filter="url(#filter-emboss)" 
                              text-anchor="middle" dominant-baseline="middle" 
                              font-size="120px" font-weight="900" font-family="'Arial Black', 'Impact', sans-serif">SECURITY</text>
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-4', 'embossed')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">5. 3D Anaglyph</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-5" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <filter id="filter-anaglyph">
                                <feFlood flood-color="#FF0000" result="red" />
                                <feComposite in="red" in2="SourceAlpha" operator="in" result="red-clip" />
                                <feOffset in="red-clip" dx="-3" dy="0" result="red-offset" />
                                <feFlood flood-color="#00FFFF" result="cyan" />
                                <feComposite in="cyan" in2="SourceAlpha" operator="in" result="cyan-clip" />
                                <feOffset in="cyan-clip" dx="3" dy="0" result="cyan-offset" />
                                <feMerge>
                                    <feMergeNode in="red-offset"/><feMergeNode in="cyan-offset"/><feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <text id="svg-text-5" class="svg-text-base" x="400" y="200" fill="black" filter="url(#filter-anaglyph)" 
                              text-anchor="middle" dominant-baseline="middle" 
                              font-size="120px" font-weight="900" font-family="'Arial Black', 'Impact', sans-serif">SECURITY</text>
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-5', 'anaglyph-3d')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">6. Halftone (Dot Matrix)</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-6" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <pattern id="pattern-dots" width="8" height="8" patternUnits="userSpaceOnUse">
                                <circle cx="4" cy="4" r="3" fill="black" />
                            </pattern>
                            <mask id="text-mask-6">
                                <rect width="800" height="400" fill="black" />
                                <text id="svg-text-6" class="svg-text-base" x="400" y="200" fill="white" 
                                      text-anchor="middle" dominant-baseline="middle" 
                                      font-size="120px" font-weight="900" font-family="'Arial Black', 'Impact', sans-serif">SECURITY</text>
                            </mask>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <rect width="800" height="400" fill="url(#pattern-dots)" mask="url(#text-mask-6)" />
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-6', 'halftone-dots')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">7. Noise Texture</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-7" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <filter id="filter-noise">
                                <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="3" stitchTiles="stitch" result="noise" />
                                <feDiffuseLighting in="noise" lighting-color="white" surfaceScale="2" result="lit">
                                    <feDistantLight azimuth="45" elevation="60" />
                                </feDiffuseLighting>
                                <feComposite in="lit" in2="SourceGraphic" operator="in" />
                            </filter>
                            <text id="svg-text-7" class="svg-text-base" x="400" y="200" fill="black" 
                                  text-anchor="middle" dominant-baseline="middle" 
                                  font-size="120px" font-weight="900" font-family="'Arial Black', 'Impact', sans-serif">SECURITY</text>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <use href="#svg-text-7" filter="url(#filter-noise)" />
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-7', 'noise-texture')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 shadow-sm">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">8. Fragmented (Glitch)</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-8" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <text id="svg-text-8" class="svg-text-base" x="400" y="200" fill="black" 
                                  text-anchor="middle" dominant-baseline="middle" 
                                  font-size="120px" font-weight="900" font-family="'Arial Black', 'Impact', sans-serif">SECURITY</text>
                            <clipPath id="clip-slice-1"><rect x="0" y="0" width="800" height="100"/></clipPath>
                            <clipPath id="clip-slice-2"><rect x="0" y="100" width="800" height="100"/></clipPath>
                            <clipPath id="clip-slice-3"><rect x="0" y="200" width="800" height="100"/></clipPath>
                            <clipPath id="clip-slice-4"><rect x="0" y="300" width="800" height="100"/></clipPath>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <use href="#svg-text-8" clip-path="url(#clip-slice-1)" transform="translate(5, 0)"/>
                        <use href="#svg-text-8" clip-path="url(#clip-slice-2)" transform="translate(-10, 0)"/>
                        <use href="#svg-text-8" clip-path="url(#clip-slice-3)" transform="translate(10, 0)"/>
                        <use href="#svg-text-8" clip-path="url(#clip-slice-4)" transform="translate(-5, 0)"/>
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-8', 'fragmented-glitch')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <div class="border border-blue-200 rounded-lg p-4 shadow-sm bg-blue-50">
                <h2 class="text-xl font-semibold text-blue-800 mb-4">9. Microtext Pattern (Advanced)</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-9" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <pattern id="pattern-microtext" width="100" height="18" patternUnits="userSpaceOnUse">
                                <text x="0" y="15" font-family="Arial, sans-serif" font-weight="600" font-size="10" fill="#888">GENUINE</text>
                            </pattern>
                            <mask id="text-mask-9">
                                <rect width="800" height="400" fill="black" />
                                <text id="svg-text-9" class="svg-text-base" x="400" y="200" fill="white" 
                                      text-anchor="middle" dominant-baseline="middle" 
                                      font-size="120px" font-weight="900" font-family="'Arial Black', 'Impact', sans-serif">SECURITY</text>
                            </mask>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <rect width="800" height="400" fill="url(#pattern-microtext)" mask="url(#text-mask-9)" />
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-9', 'microtext')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <div class="border border-blue-200 rounded-lg p-4 shadow-sm bg-blue-50">
                <h2 class="text-xl font-semibold text-blue-800 mb-4">10. Engraved (Intaglio) (Advanced)</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-10" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <filter id="filter-engraved">
                                <feGaussianBlur stdDeviation="1" in="SourceAlpha" result="blur" />
                                <feSpecularLighting in="blur" surfaceScale="5" specularConstant=".75" specularExponent="20" lighting-color="#999" result="spec">
                                    <feDistantLight azimuth="225" elevation="80" />
                                </feSpecularLighting>
                                <feComposite in="spec" in2="SourceGraphic" operator="in" result="engraved" />
                                <feComposite in="SourceGraphic" in2="engraved" operator="arithmetic" k1="0" k2="1" k3="1" k4="0"/>
                            </filter>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <text id="svg-text-10" class="svg-text-base" x="400" y="200" fill="#555" filter="url(#filter-engraved)" 
                              text-anchor="middle" dominant-baseline="middle" 
                              font-size="120px" font-weight="900" font-family="'Arial Black', 'Impact', sans-serif">SECURITY</text>
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-10', 'engraved')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <div class="border border-blue-200 rounded-lg p-4 shadow-sm bg-blue-50">
                <h2 class="text-xl font-semibold text-blue-800 mb-4">11. Wavy Path (Advanced)</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-11" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <path id="wavy-path" d="M 50,200 Q 250,150 400,200 T 750,200" fill="none" stroke="none" />
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <text class="svg-text-base" fill="black" 
                              font-size="120px" font-weight="900" font-family="'Arial Black', 'Impact', sans-serif">
                            <textPath id="svg-text-11" href="#wavy-path" startOffset="50%" text-anchor="middle" textLength="700" lengthAdjust="spacingAndGlyphs">SECURITY</textPath>
                        </text>
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-11', 'wavy-path')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <div class="border border-blue-200 rounded-lg p-4 shadow-sm bg-blue-50">
                <h2 class="text-xl font-semibold text-blue-800 mb-4">12. Distortion (Advanced)</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-12" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <filter id="filter-displacement">
                                <feTurbulence type="fractalNoise" baseFrequency="0.03" numOctaves="1" seed="2" result="turbulence"/>
                                <feDisplacementMap in2="turbulence" in="SourceGraphic" scale="15" xChannelSelector="R" yChannelSelector="G"/>
                            </filter>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <text id="svg-text-12" class="svg-text-base" x="400" y="200" fill="black" filter="url(#filter-displacement)" 
                              text-anchor="middle" dominant-baseline="middle" 
                              font-size="120px" font-weight="900" font-family="'Arial Black', 'Impact', sans-serif">SECURITY</text>
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-12', 'displacement')" class="download-btn">Download .PNG</button>
                </div>
            </div>
            
            <div class="border border-green-200 rounded-lg p-4 shadow-sm bg-green-50">
                <h2 class="text-xl font-semibold text-green-800 mb-4">13. Warped Checkerboard</h2>
                <div class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <svg id="illusion-svg-13" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto">
                        <defs>
                            <filter id="filter-warp">
                                <feTurbulence type="fractalNoise" baseFrequency="0.015" numOctaves="3" result="noise"/>
                                <feDisplacementMap in="SourceGraphic" in2="noise" scale="50" />
                            </filter>
                            <pattern id="pattern-check" width="50" height="50" patternUnits="userSpaceOnUse">
                                <rect width="25" height="25" fill="black"/>
                                <rect x="25" y="25" width="25" height="25" fill="black"/>
                            </pattern>
                            <mask id="text-mask-13">
                                <rect width="800" height="400" fill="white" />
                                <text id="svg-text-13" class="svg-text-base" x="400" y="200" fill="black" 
                                      text-anchor="middle" dominant-baseline="middle" 
                                      font-size="120px" font-weight="900" font-family="'Arial Black', 'Impact', sans-serif">SECURITY</text>
                            </mask>
                        </defs>
                        <rect width="800" height="400" fill="white" />
                        <rect width="800" height="400" fill="url(#pattern-check)" filter="url(#filter-warp)" mask="url(#text-mask-13)" />
                    </svg>
                </div>
                <div class="text-center">
                    <button type="button" onclick="downloadPNG(this, 'illusion-svg-13', 'warped-check')" class="download-btn">Download .PNG</button>
                </div>
            </div>
            
            <div class="border border-green-200 rounded-lg p-4 shadow-sm bg-green-50">
                <h2 class="text-xl font-semibold text-green-800 mb-4">14. Tilt-to-Read Text with Small Image Background</h2>
                <p class="text-sm text-gray-600 -mt-3 mb-4">(This effect has its own inputs; text lines are filled with a finely tiled, small version of the provided image as background texture for the tilt illusion)</p>
                
                <canvas id="tilt-canvas"></canvas>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                    <div>
                        <label for="hText" class="block text-sm font-medium text-gray-700 mb-1">Horizontal Text</label>
                        <input type="text" placeholder="Type horizontal text..." id="hText" class="tilt-input" value="PRINTED BY" />
                    </div>
                    <div>
                        <label for="vText" class="block text-sm font-medium text-gray-700 mb-1">Vertical Text</label>
                        <input type="text" placeholder="Type vertical text..." id="vText" class="tilt-input" value="MICRO PRESS LTD" />
                    </div>
                    <div>
                        <label for="colorImageUrl" class="block text-sm font-medium text-gray-700 mb-1">Small Image URL (for texture)</label>
                        <input type="url" placeholder="https://example.com/image.jpg" id="colorImageUrl" class="tilt-input" value="https://via.placeholder.com/400x300/FF6B6B/4ECDC4?text=Color+Image" />
                        <img id="colorPreview" class="image-preview" style="display: none;" alt="Preview" />
                    </div>
                </div>
                <div class="text-center mt-6">
                    <button type="button" onclick="loadAndUpdateTiltCanvas()" class="download-btn mr-2">Load & Update</button>
                    <button type="button" onclick="downloadTiltCanvas(this, 'tilt-canvas')" class="download-btn">Download .PNG</button>
                </div>
            </div>

            <div class="border border-purple-200 rounded-lg p-4 shadow-sm bg-purple-50 lg:col-span-2">
                <h2 class="text-xl font-semibold text-purple-800 mb-4">15. Image to ASCII using Specified Text (Advanced)</h2>
                <p class="text-sm text-gray-600 -mt-3 mb-4">(Enter an image URL and text; converts the image to ASCII art using characters from the text, mapped by pixel brightness for a hidden image illusion)</p>
                
                <canvas id="ascii-canvas"></canvas>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    <div>
                        <label for="asciiText" class="block text-sm font-medium text-gray-700 mb-1">Text for ASCII Chars</label>
                        <input type="text" placeholder="e.g., SECURITY" id="asciiText" class="ascii-input" value="SECURITY" />
                    </div>
                    <div>
                        <label for="asciiImageUrl" class="block text-sm font-medium text-gray-700 mb-1">Image URL</label>
                        <input type="url" placeholder="https://example.com/image.jpg" id="asciiImageUrl" class="ascii-input" value="https://via.placeholder.com/400x300/4ECDC4/FFFFFF?text=Image" />
                        <img id="asciiPreview" class="image-preview" style="display: none;" alt="Preview" />
                    </div>
                </div>
                <div class="text-center mt-6">
                    <button type="button" onclick="loadAndUpdateAsciiCanvas()" class="download-btn mr-2">Load & Update</button>
                    <button type="button" onclick="downloadAsciiCanvas(this, 'ascii-canvas')" class="download-btn">Download .PNG</button>
                </div>
            </div>

        </div> </div>

    <template id="loading-button-template">
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-currentColor" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Generating...
    </template>
    
    <style>
        .download-btn {
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            border: 1px solid #D1D5DB; /* border-gray-300 */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            font-size: 1rem; /* text-base */
            font-weight: 500; /* font-medium */
            border-radius: 0.5rem; /* rounded-lg */
            color: #374151; /* text-gray-700 */
            background-color: white;
            transition: background-color 0.15s ease-in-out;
            cursor: pointer;
        }
        .download-btn:hover {
            background-color: #F9FAFB; /* hover:bg-gray-50 */
        }
        .download-btn:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 2px #60A5FA, 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* focus rings */
        }
        .download-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
    </style>

    <script>
        // --- Main controller function ---
        function updateAllText() {
            const input = document.getElementById('text-input');
            const newText = input.value.toUpperCase() || ' ';
            
            // Update all 13 SVG text elements
            for (let i = 1; i <= 13; i++) {
                updateSVGText(`svg-text-${i}`, newText);
            }
        }

        // --- Refactored text scaling function for live preview ---
        function updateSVGText(textId, newText) {
            const svgText = document.getElementById(textId);
            if (!svgText) return;

            svgText.textContent = newText;

            // Special case for wavy text path
            if (textId === 'svg-text-11') {
                return; 
            }
            
            // Standard font-size scaling
            // We read the base font size from the inline attribute
            const baseFontSize = parseFloat(svgText.getAttribute("font-size")) || 120;
            const maxTextWidth = 780; 
            
            svgText.setAttribute("font-size", baseFontSize + 'px');

            setTimeout(() => {
                let currentWidth = 0;
                try {
                    currentWidth = svgText.getBBox().width;
                } catch (e) { currentWidth = 0; }

                if (currentWidth > maxTextWidth) {
                    const ratio = maxTextWidth / currentWidth;
                    const newFontSize = baseFontSize * ratio;
                    svgText.setAttribute("font-size", newFontSize + 'px');
                }
            }, 0); 
        }
        
        // --- Call update on page load ---
        window.onload = () => {
            updateAllText();
            initializeTiltCanvas(); // Initialize the tilt canvas
            initializeAsciiCanvas(); // Initialize the new ASCII canvas
        };
        
        
        // --- SCRIPT for Tilt-to-Read Text with Small Tiled Image Background (unchanged) ---
        
        let tiltCanvas, tiltCtx, tiltScale, tiltText, colorImage;
        let colorImageLoaded = false;
        const TILE_SIZE = 10; // Size of small tiled image (px) - adjust for finer/coarser texture

        function initializeTiltCanvas() {
            tiltCanvas = document.getElementById('tilt-canvas');
            if (!tiltCanvas) return;
            
            tiltCtx = tiltCanvas.getContext('2d');

            tiltCanvas.width = 500;
            tiltCanvas.height = 500;
            tiltCtx.font = '25px Arial';
            tiltCtx.textAlign = 'center';
            tiltCtx.textBaseline = 'middle';

            tiltScale = {
              h: tiltCanvas.height / 20,
              v: tiltCanvas.width / 20
            };
            
            tiltText = {
              h: document.getElementById('hText').value.toUpperCase(),
              v: document.getElementById('vText').value.toUpperCase()
            };
            
            colorImage = new Image();
            
            document.getElementById('hText').oninput = function() {
              tiltText.h = this.value.toUpperCase();
              updateTiltCanvas();
            };
            
            document.getElementById('vText').oninput = function() {
              tiltText.v = this.value.toUpperCase();
              updateTiltCanvas();
            };
            
            document.getElementById('colorImageUrl').oninput = function() {
                const url = this.value;
                const preview = document.getElementById('colorPreview');
                if (url) {
                    preview.src = url;
                    preview.style.display = 'block';
                    colorImage.onload = () => {
                        colorImageLoaded = true;
                        updateTiltCanvas();
                    };
                    colorImage.onerror = () => {
                        console.error('Failed to load color image');
                        colorImageLoaded = false;
                        updateTiltCanvas();
                    };
                    colorImage.src = url;
                } else {
                    preview.style.display = 'none';
                    colorImageLoaded = false;
                    updateTiltCanvas();
                }
            };
            
            updateTiltCanvas();
        }

        function loadAndUpdateTiltCanvas() {
            // Trigger input events to reload
            document.getElementById('colorImageUrl').dispatchEvent(new Event('input'));
            updateTiltCanvas();
        }

        function updateTiltCanvas() {
            if (!tiltCtx) return;
            
            tiltCtx.fillStyle = "#fff";
            tiltCtx.fillRect(0, 0, tiltCanvas.width, tiltCanvas.height);

            // Create small tiled pattern from color image if loaded
            let pattern;
            if (colorImageLoaded) {
                // Create a small temporary canvas for the tile
                const tileCanvas = document.createElement('canvas');
                tileCanvas.width = TILE_SIZE;
                tileCanvas.height = TILE_SIZE;
                const tileCtx = tileCanvas.getContext('2d');
                
                // Scale and draw the image to the small tile (preserving aspect ratio)
                const scale = Math.min(TILE_SIZE / colorImage.width, TILE_SIZE / colorImage.height);
                const drawW = colorImage.width * scale;
                const drawH = colorImage.height * scale;
                const offsetX = (TILE_SIZE - drawW) / 2;
                const offsetY = (TILE_SIZE - drawH) / 2;
                tileCtx.fillStyle = "#fff"; // White background for tile if image doesn't fill
                tileCtx.fillRect(0, 0, TILE_SIZE, TILE_SIZE);
                tileCtx.drawImage(colorImage, offsetX, offsetY, drawW, drawH);
                
                // Use the small tile as repeating pattern
                pattern = tiltCtx.createPattern(tileCanvas, 'repeat');
            }

            tiltCtx.fillStyle = pattern || "#000"; // Fallback to black

            // Draw horizontal text (becomes thin horizontal lines with small image texture)
            tiltCtx.save();
            tiltCtx.scale(1, tiltScale.h);
            tiltCtx.fillText(tiltText.h, tiltCanvas.width / 2, tiltCanvas.height / tiltScale.h / 2);
            tiltCtx.restore();

            // Draw vertical text (becomes thin vertical lines with small image texture)
            tiltCtx.save();
            tiltCtx.translate(tiltCanvas.width / 2, tiltCanvas.height / 2);
            tiltCtx.rotate(Math.PI / 2);
            tiltCtx.translate(-tiltCanvas.width / 2, -tiltCanvas.width / 2); 
            tiltCtx.scale(1, tiltScale.v);
            tiltCtx.fillText(tiltText.v, tiltCanvas.width / 2, tiltCanvas.height / tiltScale.v / 2);
            tiltCtx.restore();
        }
        
        function downloadTiltCanvas(button, canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const originalButtonHTML = button.innerHTML;
            const loadingTemplate = document.getElementById('loading-button-template');
            button.innerHTML = loadingTemplate.innerHTML;
            button.disabled = true;

            try {
                const dataUrl = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = dataUrl;
                
                const h = document.getElementById('hText').value || 'tilt-h';
                const v = document.getElementById('vText').value || 'tilt-v';
                const imgUrl = document.getElementById('colorImageUrl').value || 'textured';
                const imgName = imgUrl.split('/').pop().split('?')[0] || 'image';
                const filename = `tilt-read-text-${h.toLowerCase().replace(/\s+/g, '-')}-${v.toLowerCase().replace(/\s+/g, '-')}-${imgName}.png`;
                link.download = filename;

                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (err) {
                console.error("Error downloading canvas:", err);
                alert('Download failed—check console for details. Try refreshing the page.');
            }
            
            button.innerHTML = originalButtonHTML;
            button.disabled = false;
        }

        // --- NEW SCRIPT for Image to ASCII using Specified Text ---
        
        let asciiCanvas, asciiCtx, asciiImage;
        let asciiImageLoaded = false;

        function initializeAsciiCanvas() {
            asciiCanvas = document.getElementById('ascii-canvas');
            if (!asciiCanvas) return;
            
            asciiCtx = asciiCanvas.getContext('2d');

            asciiCanvas.width = 500;
            asciiCanvas.height = 400;

            asciiImage = new Image();
            
            document.getElementById('asciiText').oninput = function() {
                updateAsciiCanvas();
            };
            
            document.getElementById('asciiImageUrl').oninput = function() {
                const url = this.value;
                const preview = document.getElementById('asciiPreview');
                if (url) {
                    preview.src = url;
                    preview.style.display = 'block';
                    asciiImage.onload = () => {
                        asciiImageLoaded = true;
                        updateAsciiCanvas();
                    };
                    asciiImage.onerror = () => {
                        console.error('Failed to load ASCII image');
                        asciiImageLoaded = false;
                        updateAsciiCanvas();
                    };
                    asciiImage.src = url;
                } else {
                    preview.style.display = 'none';
                    asciiImageLoaded = false;
                    updateAsciiCanvas();
                }
            };
            
            updateAsciiCanvas();
        }

        function loadAndUpdateAsciiCanvas() {
            // Trigger input events to reload
            document.getElementById('asciiImageUrl').dispatchEvent(new Event('input'));
            updateAsciiCanvas();
        }

        function updateAsciiCanvas() {
            if (!asciiCtx || !asciiImageLoaded) return;
            
            asciiCtx.fillStyle = "#fff";
            asciiCtx.fillRect(0, 0, asciiCanvas.width, asciiCanvas.height);

            const text = document.getElementById('asciiText').value.toUpperCase() || ' ';
            const chars = text.split('').filter((c, i, arr) => arr.indexOf(c) === i); // Unique chars from text
            if (chars.length === 0) return;

            // Sort chars by approximate width for better mapping (darker/wider chars for darker pixels)
            const sortedChars = chars.sort((a, b) => {
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = 100;
                tempCanvas.height = 100;
                const tempCtx = tempCanvas.getContext('2d');
                tempCtx.font = '20px monospace';
                return tempCtx.measureText(b).width - tempCtx.measureText(a).width;
            });

            // Draw image to temp canvas to sample pixels
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = asciiCanvas.width * 4; // Higher res for better sampling
            tempCanvas.height = asciiCanvas.height * 4;
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.drawImage(asciiImage, 0, 0, tempCanvas.width, tempCanvas.height);

            const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height).data;

            asciiCtx.font = '8px monospace'; // Small font for dense ASCII
            asciiCtx.fillStyle = '#000';
            asciiCtx.textAlign = 'center';
            asciiCtx.textBaseline = 'middle';

            const charWidth = 8; // Approx char width in px
            const charHeight = 12; // Approx char height

            for (let y = 0; y < asciiCanvas.height; y += charHeight) {
                for (let x = 0; x < asciiCanvas.width; x += charWidth) {
                    // Sample average brightness from 4x4 block
                    let totalBrightness = 0;
                    let samples = 0;
                    for (let dy = 0; dy < 4 && y * 4 + dy < tempCanvas.height; dy++) {
                        for (let dx = 0; dx < 4 && x * 4 + dx < tempCanvas.width; dx++) {
                            const i = ((y * 4 + dy) * tempCanvas.width + (x * 4 + dx)) * 4;
                            const r = imageData[i], g = imageData[i + 1], b = imageData[i + 2];
                            totalBrightness += (r + g + b) / 3;
                            samples++;
                        }
                    }
                    const avgBrightness = totalBrightness / samples;
                    const index = Math.floor((1 - avgBrightness / 255) * (sortedChars.length - 1)); // Darker -> earlier (wider) char
                    const char = sortedChars[index] || ' ';

                    asciiCtx.fillText(char, x + charWidth / 2, y + charHeight / 2);
                }
            }
        }
        
        function downloadAsciiCanvas(button, canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const originalButtonHTML = button.innerHTML;
            const loadingTemplate = document.getElementById('loading-button-template');
            button.innerHTML = loadingTemplate.innerHTML;
            button.disabled = true;

            try {
                const dataUrl = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = dataUrl;
                
                const text = document.getElementById('asciiText').value || 'ascii';
                const imgUrl = document.getElementById('asciiImageUrl').value || 'image';
                const imgName = imgUrl.split('/').pop().split('?')[0] || 'image';
                const filename = `ascii-illusion-${text.toLowerCase().replace(/\s+/g, '-')}-${imgName}.png`;
                link.download = filename;

                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (err) {
                console.error("Error downloading canvas:", err);
                alert('Download failed—check console for details. Try refreshing the page.');
            }
            
            button.innerHTML = originalButtonHTML;
            button.disabled = false;
        }

        // --- Refactored, reusable download function for SVGs ---
        function downloadPNG(button, svgId, filenameBase) {
            const svg = document.getElementById(svgId);
            if (!svg) return;
            
            // Store original HTML to restore it later
            button.originalHTML = button.innerHTML; 
            const loadingTemplate = document.getElementById('loading-button-template');
            button.innerHTML = loadingTemplate.innerHTML;
            button.disabled = true;

            const canvasWidth = 1600;
            const canvasHeight = 800;

            const svgData = new XMLSerializer().serializeToString(svg);
            const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(svgBlob);

            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                canvas.width = canvasWidth;
                canvas.height = canvasHeight;
                const ctx = canvas.getContext('2d');

                // Draw the SVG to the canvas. The absolute x/y in the SVG
                // will now be respected relative to the viewBox.
                ctx.drawImage(img, 0, 0, canvasWidth, canvasHeight);

                // Finalize the download
                finalizeDownload(canvas, button, filenameBase);
                URL.revokeObjectURL(url);
            };
            
            img.onerror = function(err) {
                console.error("Error loading SVG into image.", err);
                button.innerHTML = button.originalHTML;
                button.disabled = false;
                URL.revokeObjectURL(url);
            }
            
            img.src = url;
        }

        function finalizeDownload(canvas, button, filenameBase) {
            const pngDataUrl = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.href = pngDataUrl;
            
            const inputText = document.getElementById('text-input').value || 'illusion';
            const filename = `${filenameBase}-${inputText.toLowerCase().replace(/\s+/g, '-')}.png`;
            link.download = filename;

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Restore button
            button.innerHTML = button.originalHTML; // Use stored original HTML
            button.disabled = false;
        }
    </script>

</body>
    </html>
